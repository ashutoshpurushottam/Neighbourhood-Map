function loadMap(){map=new google.maps.Map(document.getElementById("map-container"),{center:{lat:37.3899,lng:-122.0839},zoom:13}),ko.applyBindings(new ViewModel)}function googleError(){alert("Error in loading google map")}var ViewModel=function(){"use strict";var a=this;a.restaurants=ko.observableArray([]),a.filteredRestaurants=ko.observableArray([]),a.restaurantItems=function(){restaurants.forEach(function(b){var c=new Restaurant(b);a.restaurants.push(c),c.marker().setAnimation(google.maps.Animation.DROP)})},a.searchString=ko.observable(""),a.worker=ko.computed(function(){a.searchString()&&a.restaurantFilter()},this),a.restaurantFilter=function(){a.filteredRestaurants([]);for(var b=a.restaurants().length,c=a.searchString(),d=0;d<b;d++){var e=a.restaurants()[d].name().toLowerCase(),f=a.restaurants()[d].address().toLowerCase();f=f.replace(/\s+/g,""),e.indexOf(c)>-1||f.indexOf(c)>-1?(a.filteredRestaurants.push(a.restaurants()[d]),a.restaurants()[d].marker().setVisible(!0)):a.restaurants()[d].marker().setVisible(!1)}},a.setRestaurantClicks=function(){a.restaurants().forEach(function(b){google.maps.event.addListener(b.marker(),"click",function(){a.clickRestaurantMarker(b)})})},a.clickRestaurantMarker=function(b){b.marker().setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){b.marker().setAnimation(null)},500),map.panTo(new google.maps.LatLng(b.lat(),b.lng())),a.yelpRequest(b)},a.yelpRequest=function(a){var b=function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;c<20;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a},c="http://api.yelp.com/v2/search/",d={oauth_consumer_key:yelpKeyData.consumerKey,oauth_token:yelpKeyData.token,oauth_nonce:b(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:a.name(),location:"Mountain View, CA",limit:1},e=oauthSignature.generate("GET",c,d,yelpKeyData.consumerSecret,yelpKeyData.tokenSecret);d.oauth_signature=e;var f={url:c,data:d,timeout:3e3,cache:!0,dataType:"jsonp",success:function(b){var c,d=new google.maps.InfoWindow({content:""}),e=b.businesses[0].rating_img_url,f=b.businesses[0].url;c=e&&f?'<div class="modal fade" id="myModal" tabindex="-1"role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" id="myModalLabel">'+a.name()+'</h4></div><div class="modal-body">'+a.address()+"<br>"+a.description()+'<div><a id="url-yelp" target="_blank" class="yelp-link" href="'+f+'"><br><span id="rating-text">Yelp Rating: </span></a><img src="'+e+'"></div></div></div></div>':'<div class="modal fade" id="myModal" tabindex="-1"role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" id="myModalLabel">'+a.name()+'</h4></div><div class="modal-body">'+a.address()+"<br>"+a.description()+'<br><div><span id="rating-text">Could not retrieve yelp rating</span></a></div></div></div>',d.setContent(c),d.open(map,a.marker())},error:function(){var b=new google.maps.InfoWindow({content:""}),c='<div class="modal fade" id="myModal" tabindex="-1"role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title" id="myModalLabel">'+a.name()+'</h4></div><div class="modal-body">'+a.address()+"<br>"+a.description()+'<br><div><span id="rating-text">Could not retrieve yelp rating</span></a></div></div></div>';b.setContent(c),b.open(map,a.marker())}};$.ajax(f)},google.maps.event.addDomListener(window,"load",function(){a.restaurantItems(),a.setRestaurantClicks(),a.filteredRestaurants(a.restaurants())})},map;